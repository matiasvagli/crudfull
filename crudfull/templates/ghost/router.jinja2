from fastapi import APIRouter, HTTPException
from typing import List

from .schemas import {{ model_name }}Create, {{ model_name }}Update, {{ model_name }}Response
from .service import {{ model_name }}Service
from .repository import {{ model_name }}Repository

router = APIRouter(prefix="/{{ resource }}", tags=["{{ model_name }}"])
repository = {{ model_name }}Repository()
service = {{ model_name }}Service(repository)

@router.get("/", response_model=List[{{ model_name }}Response])
async def list_{{ resource }}():
    return await service.list()

@router.get("/{id}", response_model={{ model_name }}Response)
async def read_{{ singular }}(id: int):
    item = await service.get(id)
    if not item:
        raise HTTPException(status_code=404, detail="Item not found")
    return item

@router.post("/", response_model={{ model_name }}Response)
async def create_{{ singular }}(item: {{ model_name }}Create):
    return await service.create(item)

@router.patch("/{id}", response_model={{ model_name }}Response)
async def update_{{ singular }}(id: int, item: {{ model_name }}Update):
    updated = await service.update(id, item)
    if not updated:
        raise HTTPException(status_code=404, detail="Item not found")
    return updated

@router.delete("/{id}", response_model={{ model_name }}Response)
async def delete_{{ singular }}(id: int):
    deleted = await service.delete(id)
    if not deleted:
        raise HTTPException(status_code=404, detail="Item not found")
    return deleted
