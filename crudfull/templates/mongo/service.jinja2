from .models import {{ model_name }}
from .schemas import {{ model_name }}Create, {{ model_name }}Update, {{ model_name }}Response

class {{ model_name }}Service:
    def _to_response(self, doc: {{ model_name }}) -> {{ model_name }}Response:
        """Convert Beanie document to Response schema with ObjectId as string"""
        doc_dict = doc.model_dump()
        doc_dict['id'] = str(doc.id)
        return {{ model_name }}Response(**doc_dict)

    async def list(self):
        docs = await {{ model_name }}.find().to_list()
        return [self._to_response(doc) for doc in docs]

    async def create(self, item: {{ model_name }}Create):
        doc = {{ model_name }}(**item.model_dump())
        await doc.insert()
        return self._to_response(doc)

    async def read(self, id: str):
        doc = await {{ model_name }}.get(id)
        if not doc:
            return None
        return self._to_response(doc)

    async def update(self, id: str, item: {{ model_name }}Update):
        doc = await {{ model_name }}.get(id)
        if not doc:
            return None
        
        await doc.set(item.model_dump(exclude_unset=True))
        return self._to_response(doc)

    async def delete(self, id: str):
        doc = await {{ model_name }}.get(id)
        if not doc:
            return None
        
        await doc.delete()
        return self._to_response(doc)
