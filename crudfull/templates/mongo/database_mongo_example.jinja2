{# Example of Beanie + Motor connection (dual-mode: uses env vars with defaults) #}

import os
from motor.motor_asyncio import AsyncIOMotorClient
from beanie import init_beanie
from dotenv import load_dotenv
load_dotenv()

from models.{{ model_file }} import {{ model_name }}Document


async def init_db():
    # Read configuration from environment variables (if present) or use default values.
    mongo_host = os.getenv("MONGO_HOST", "localhost")
    mongo_port = os.getenv("MONGO_PORT", "27017")
    mongo_db = os.getenv("MONGO_DATABASE", "mydb")
    mongo_user = os.getenv("MONGO_INITDB_ROOT_USERNAME", "")
    mongo_pass = os.getenv("MONGO_INITDB_ROOT_PASSWORD", "")

    if mongo_user and mongo_pass:
        mongo_uri = f"mongodb://{mongo_user}:{mongo_pass}@{mongo_host}:{mongo_port}"
    else:
        mongo_uri = f"mongodb://{mongo_host}:{mongo_port}"

    client = AsyncIOMotorClient(mongo_uri)
    await init_beanie(
        database=getattr(client, mongo_db),
        document_models=[{{ model_name }}Document],
    )

